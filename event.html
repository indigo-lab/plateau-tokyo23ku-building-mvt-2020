<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>plateau-building event</title>
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@1.14.0/dist/maplibre-gl.css" />
  <script src="https://unpkg.com/maplibre-gl@1.14.0/dist/maplibre-gl.js"></script>
  <style>
    .my-popup b {
      background: orange;
      border: 1px solid black;
      color: black;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div id="map" style="position:absolute;top:0;left:0;bottom:0;right:0;"></div>
  <script>
    const base = new URL("./", location.href).toString().replace(/\/$/, "");

    const map = new maplibregl.Map({
      "container": "map",
      "center": [139.677879, 35.647049],
      "zoom": 17.35,
      "pitch": 51,
      "bearing": 18.7,
      "hash": true,
      "style": {
        "version": 8,
        "glyphs": "https://maps.gsi.go.jp/xyz/noto-jp/{fontstack}/{range}.pbf",
        "sources": {
          "pale": {
            "type": "raster",
            "tiles": [
              "https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png"
            ],
            "minzoom": 5,
            "maxzoom": 18,
            "tileSize": 256,
            "attribution": "<a href='http://maps.gsi.go.jp/development/ichiran.html'>地理院タイル</a>"
          },
          "plateau": {
            "type": "vector",
            "tiles": [
              `${base}/{z}/{x}/{y}.pbf`
            ],
            "minzoom": 10,
            "maxzoom": 16,
            "attribution": "<a href='https://www.mlit.go.jp/plateau/'>国土交通省 Project PLATEAU</a> のデータを加工して作成"
          }
        },
        "layers": [{
          "id": "pale",
          "type": "raster",
          "source": "pale",
          "minzoom": 5,
          "maxzoom": 20
        }, {
          "id": "bldg",
          "type": "fill-extrusion",
          "source": "plateau",
          "source-layer": "bldg",
          "minzoom": 5,
          "maxzoom": 20,
          "paint": {
            "fill-extrusion-color": "#008800",
            "fill-extrusion-height": ["get", "measuredHeight"]
          }
        }]
      }
    });


    // When a click event occurs on a feature in the places layer, open a popup at the
    // location of the feature, with description HTML from its properties.
    map.on('click', 'bldg', function(e) {
      const dl = document.createElement("dl");
      const prop = e.features[0].properties;
      const html = "<div class='my-popup'>" + Object.keys(prop).map(k => `<b>${k}</b> <span>${prop[k]}</span>`).join("<br/>") + "</div>"
      new maplibregl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(html)
        .addTo(map);
    });

    // Change the cursor to a pointer when the mouse is over the places layer.
    map.on('mouseenter', 'bldg', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    // Change it back to a pointer when it leaves.
    map.on('mouseleave', 'bldg', function() {
      map.getCanvas().style.cursor = '';
    });
  </script>
</body>

</html>
